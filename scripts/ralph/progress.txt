# Ralph Progress Log
Started: 2026-01-11
Feature: OSRS GE Trading Dashboard

## Codebase Patterns
- Backend: AdonisJS 6 with Lucid ORM
- Frontend: Next.js 16 with React 19
- Database: SQLite with better-sqlite3
- UI: Shadcn components

## Key Files
- backend/app/models/
- backend/app/services/
- backend/app/controllers/
- frontend/components/
- frontend/hooks/
- frontend/lib/api.ts
---

## 2026-01-11 - US-001
- What was implemented: Items table migration for OSRS item storage
- Files changed:
  - backend/database/migrations/1768149415468_create_items_table.ts (created)
- **Learnings:**
  - AdonisJS 6 migrations use `node ace make:migration <name>` to generate
  - For non-auto-incrementing PKs, use `table.integer('id').primary().notNullable()` instead of `table.increments()`
  - Migration runs with `node ace migration:run`
---

## 2026-01-11 - US-002
- What was implemented: Item prices table migration with foreign key to items
- Files changed:
  - backend/database/migrations/1768149468619_create_item_prices_table.ts (created)
- **Learnings:**
  - Foreign keys use `.references('id').inTable('table').onDelete('CASCADE')` syntax
  - Indexes created with `table.index(['column_name'])`
---

## 2026-01-11 - US-003, US-004
- What was implemented: Item and ItemPrice Lucid models with relationships
- Files changed:
  - backend/app/models/item.ts (created)
  - backend/app/models/item_price.ts (created)
- **Learnings:**
  - AdonisJS models use `@column()` decorator, camelCase properties map to snake_case columns
  - Relationships: `@hasMany(() => Model)` and `@belongsTo(() => Model)`
  - Computed properties use `@computed()` decorator and getter syntax
  - Import types with `type { HasMany, BelongsTo }` from `@adonisjs/lucid/types/relations`
---

## 2026-01-11 - US-005
- What was implemented: OSRS Wiki API client for fetching item mappings and prices
- Files changed:
  - backend/app/services/osrs_wiki_client.ts (created)
- **Learnings:**
  - Use `response.json() as Promise<T>` for typed JSON responses in TypeScript
  - OSRS Wiki API requires descriptive User-Agent header
---

## 2026-01-11 - US-006, US-007
- What was implemented: Sync services for items and prices from OSRS Wiki API
- Files changed:
  - backend/app/services/items_sync_service.ts (created)
  - backend/app/services/prices_sync_service.ts (created)
- **Learnings:**
  - Use `Item.updateOrCreate()` for upsert operations
  - Database transactions: `db.transaction(async (trx) => { ... })` with `{ client: trx }` option
  - `DateTime.fromSeconds()` converts Unix timestamps to Luxon DateTime
  - Import models with `#models/item` alias (AdonisJS convention)
---

## 2026-01-11 - US-008, US-009, US-010
- What was implemented: CLI commands for syncing items, prices, and both together
- Files changed:
  - backend/commands/sync_items.ts (created)
  - backend/commands/sync_prices.ts (created)
  - backend/commands/sync_all.ts (created)
- **Learnings:**
  - Create commands with `node ace make:command <name>`
  - Commands need `startApp: true` in options to use database
  - Use `this.logger.info/success/error` for output
  - Set `this.exitCode = 1` to exit with error
  - Import services with `#services/service_name` alias
---

## 2026-01-11 - US-011
- What was implemented: Items list API endpoint with pagination
- Files changed:
  - backend/app/controllers/items_controller.ts (created)
  - backend/start/routes.ts (modified)
- **Learnings:**
  - Controllers use `#controllers/controller_name` alias
  - Use lazy import for routes: `const Controller = () => import('#controllers/...')`
  - Route format: `router.get('/path', [Controller, 'method'])`
  - Use `.whereRaw()` for complex subqueries in joins
  - Access joined data via `item.$extras.column_name`
---

## 2026-01-11 - US-012 through US-017
- What was implemented: Full API endpoints for items with search, filter, sort, and suggestions
- Files changed:
  - backend/app/controllers/items_controller.ts (modified - added calculated fields, search, filters, sorting, single item)
  - backend/app/controllers/suggestions_controller.ts (created)
  - backend/start/routes.ts (modified - added routes)
- **Learnings:**
  - Use `.whereILike()` for case-insensitive search
  - SQLite uses NULLS LAST syntax for null ordering
  - Clone query before count: `query.clone().count()`
  - Calculate fields in map function to avoid complex SQL
  - Use `response.badRequest()` and `response.notFound()` for HTTP error responses
---

## 2026-01-11 - US-018 through US-021
- What was implemented: Frontend API client and app layout with mobile nav
- Files changed:
  - frontend/lib/api.ts (created)
  - frontend/components/layout/app-layout.tsx (created)
  - frontend/components/ui/sheet.tsx, button.tsx (shadcn)
  - frontend/app/layout.tsx (modified)
- **Learnings:**
  - Next.js 16 uses `'use client'` directive for client components
  - Shadcn components installed with `pnpm dlx shadcn@latest add <component>`
  - Use Sheet component for mobile navigation drawer
---

## 2026-01-11 - US-022 through US-038
- What was implemented: Dashboard components, hooks, and table
- Files changed:
  - frontend/app/page.tsx (modified - dashboard structure)
  - frontend/lib/types.ts (created)
  - frontend/hooks/use-items.ts, use-debounce.ts (created)
  - frontend/components/items-table.tsx (created)
  - frontend/components/table-skeleton.tsx (created)
  - frontend/components/error-state.tsx (created)
  - frontend/components/search-input.tsx (created)
  - frontend/components/filter-panel.tsx (created)
  - frontend/components/pagination-controls.tsx (created)
- **Learnings:**
  - Use `useCallback` to memoize fetch functions in hooks
  - URLSearchParams for building query strings
  - Shadcn Collapsible for mobile filter toggle
  - toLocaleString() for number formatting with commas
---
