{
  "project": "OSRS GE Tracker",
  "branchName": "ralph/item-groups",
  "description": "Item Group Classification System - Categorize items into groups (Armor, Weapons, Potions, etc.) for filtering and profitability tracking",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create item_groups database table",
      "description": "As a developer, I need a database table to store group definitions so they can be managed and extended.",
      "acceptanceCriteria": [
        "Create migration for item_groups table with columns: id (primary key), name (string), slug (string unique), description (string nullable), keywords (text/JSON), color (string), sort_order (integer), is_default (boolean default true), created_at, updated_at",
        "Migration runs successfully",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Create ItemGroup Lucid model",
      "description": "As a developer, I need an ORM model to interact with the item_groups table.",
      "acceptanceCriteria": [
        "Create app/models/item_group.ts extending BaseModel",
        "Define all columns with appropriate decorators: @column for primitives, @column.dateTime for timestamps",
        "Add keywords column as JSON type (stored as text in SQLite)",
        "Export model",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add group_id and classified_at to items table",
      "description": "As a developer, I need to link items to groups and track classification time.",
      "acceptanceCriteria": [
        "Create migration to add group_id column to items table (integer, nullable, references item_groups.id)",
        "Add classified_at column to items table (datetime, nullable)",
        "Foreign key should NOT cascade on delete (set null instead)",
        "Migration runs successfully",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Seed default item groups",
      "description": "As a developer, I need the 12 default groups seeded into the database.",
      "acceptanceCriteria": [
        "Create seeder for item_groups table",
        "Seed 12 groups: Armor, Weapons, Ammunition, Potions, Food, Herbs, Runes, Skilling Materials, Jewellery, Seeds, Resources, Unknown",
        "Each group has: name, slug (kebab-case), description, keywords array, color (hex), sort_order (1-12), is_default=true",
        "Unknown group has sort_order=12 (last), empty keywords array",
        "Keywords for Armor: helm, platebody, chainbody, platelegs, boots, gloves, shield, coif, d'hide, chaps",
        "Keywords for Weapons: sword, scimitar, dagger, mace, bow, crossbow, staff, wand, battleaxe, longsword",
        "Keywords for Ammunition: arrow, bolt, dart, javelin, knife, thrownaxe",
        "Keywords for Potions: potion, (1), (2), (3), (4), brew, mix",
        "Keywords for Food: shark, lobster, monkfish, karambwan, pie, cake, bass, swordfish, tuna",
        "Keywords for Herbs: grimy, guam, marrentill, tarromin, harralander, ranarr, irit, avantoe, kwuarm, snapdragon, cadantine, lantadyme, dwarf weed, torstol",
        "Keywords for Runes: fire rune, water rune, air rune, earth rune, mind rune, body rune, death rune, blood rune, soul rune, nature rune, law rune, cosmic rune, chaos rune, astral rune, wrath rune",
        "Keywords for Skilling Materials: ore, bar, log, leather, gem, uncut, plank",
        "Keywords for Jewellery: ring of, amulet of, necklace of, bracelet of",
        "Keywords for Seeds: seed",
        "Keywords for Resources: raw, bones, hide, scale, essence, feather",
        "Seeder is idempotent (checks if groups exist before inserting)",
        "Run seeder successfully",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Add Item-ItemGroup model relationships",
      "description": "As a developer, I need ORM relationships between Item and ItemGroup models.",
      "acceptanceCriteria": [
        "Update Item model: add groupId column, add @belongsTo relationship to ItemGroup",
        "Update Item model: add classifiedAt column with @column.dateTime decorator",
        "Update ItemGroup model: add @hasMany relationship to Item",
        "Import ItemGroup in Item model, Item in ItemGroup model",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create GroupsController with GET /api/groups",
      "description": "As a developer, I need an API endpoint to fetch all groups with item counts.",
      "acceptanceCriteria": [
        "Create app/controllers/groups_controller.ts",
        "Implement index method for GET /api/groups",
        "Return array of groups with fields: id, name, slug, description, keywords, color, sort_order, is_default, item_count",
        "item_count is computed by counting items with that group_id",
        "Order results by sort_order ascending",
        "Add route to start/routes.ts",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Add group include filter to items API",
      "description": "As a developer, I need to filter items by group in the items list endpoint.",
      "acceptanceCriteria": [
        "Modify ItemsController index method to accept 'group' query parameter",
        "Parameter accepts comma-separated group slugs (e.g., group=weapons,armor)",
        "Filter items where group slug matches any of the provided values",
        "Join with item_groups table to filter by slug",
        "If group param not provided, return all items (no filter)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add group exclude filter to items API",
      "description": "As a developer, I need to exclude items by group in the items list endpoint.",
      "acceptanceCriteria": [
        "Modify ItemsController index method to accept 'exclude_group' query parameter",
        "Parameter accepts comma-separated group slugs (e.g., exclude_group=unknown,herbs)",
        "Filter items where group slug does NOT match any of the provided values",
        "Items with null group_id should be included when exclude filter is active",
        "exclude_group and group params are mutually exclusive (exclude takes precedence if both provided)",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Update items API response to include group data",
      "description": "As a developer, I need items API responses to include the item's group information.",
      "acceptanceCriteria": [
        "Modify ItemsController index method to preload group relationship",
        "Include group object in each item response: { id, name, slug, color }",
        "If item has no group, return group: null",
        "Modify ItemsController show method to also include group data",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Create PATCH /api/items/:id/group endpoint",
      "description": "As a developer, I need an API endpoint to update a single item's group.",
      "acceptanceCriteria": [
        "Add updateGroup method to ItemsController",
        "Accept JSON body with groupId (number or null)",
        "Validate groupId exists in item_groups table (if not null)",
        "Update item's group_id and set classified_at to current timestamp",
        "Return updated item with group data",
        "Return 404 if item not found",
        "Return 400 if groupId is invalid",
        "Add route: PATCH /api/items/:id/group",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Create PATCH /api/items/batch-group endpoint",
      "description": "As a developer, I need an API endpoint to update multiple items' groups at once.",
      "acceptanceCriteria": [
        "Add batchUpdateGroup method to ItemsController",
        "Accept JSON body with itemIds (number array) and groupId (number)",
        "Validate groupId exists in item_groups table",
        "Update all specified items' group_id and classified_at",
        "Return { updated: number } with count of updated items",
        "Return 400 if groupId is invalid or itemIds is empty",
        "Add route: PATCH /api/items/batch-group",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Create items:classify command",
      "description": "As a developer, I need an AdonisJS command to classify items by keyword matching.",
      "acceptanceCriteria": [
        "Create app/commands/classify_items.ts using AdonisJS command pattern",
        "Command is run via: node ace items:classify",
        "Fetch all groups ordered by sort_order",
        "Fetch all items that need classification",
        "For each item: check name against each group's keywords (case-insensitive partial match)",
        "First group with any matching keyword wins (process groups in sort_order)",
        "Items with no keyword match get assigned to 'Unknown' group",
        "Update item's group_id and classified_at timestamp",
        "Log progress every 100 items",
        "Log final statistics: count per group, total processed",
        "Command is idempotent (can re-run safely)",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add classify script to package.json",
      "description": "As a developer, I need a convenient npm script to run classification.",
      "acceptanceCriteria": [
        "Add 'classify' script to backend/package.json: \"classify\": \"node ace items:classify\"",
        "Script runs successfully with: npm run classify",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Create useGroups frontend hook",
      "description": "As a frontend developer, I need a React hook to fetch available groups.",
      "acceptanceCriteria": [
        "Create frontend/hooks/use-groups.ts",
        "Define Group type matching API response",
        "Implement useGroups() hook that fetches from GET /api/groups",
        "Return { groups: Group[], isLoading: boolean, error: Error | null, refetch: () => void }",
        "Fetch on mount",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Add Group type to frontend types",
      "description": "As a frontend developer, I need TypeScript types for group data.",
      "acceptanceCriteria": [
        "Add Group interface to frontend/lib/types.ts with: id, name, slug, description, keywords, color, sort_order, is_default, item_count",
        "Add group field to Item interface: group: { id: number, name: string, slug: string, color: string } | null",
        "Add group and exclude_group to ItemsParams interface",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Update useItems hook to support group filters",
      "description": "As a frontend developer, I need the items hook to pass group filter params to API.",
      "acceptanceCriteria": [
        "Modify frontend/hooks/use-items.ts to include group param in query string if provided",
        "Include exclude_group param in query string if provided",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Add group filter to FilterPanel",
      "description": "As a user, I want to filter items by group on the dashboard.",
      "acceptanceCriteria": [
        "Add group multi-select dropdown to FilterPanel in frontend/app/page.tsx",
        "Fetch groups using useGroups hook",
        "Show group names with colored indicator matching group.color",
        "Support selecting multiple groups",
        "Add include/exclude toggle (default: include)",
        "Store selected groups and mode in component state",
        "Pass group or exclude_group param to useItems based on mode",
        "Add to reset filters functionality",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Display group badge on items table",
      "description": "As a user, I want to see each item's group at a glance in the table.",
      "acceptanceCriteria": [
        "Add 'Group' column to ItemsTable after Name column",
        "Display group name as colored badge using group.color as background",
        "If item has no group, show '-' or empty cell",
        "Badge should be compact (small text, rounded, minimal padding)",
        "Column header is 'Group'",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Show group in item detail modal",
      "description": "As a user, I want to see the item's group in the detail modal.",
      "acceptanceCriteria": [
        "Add group badge to ItemDetailModal header area (near item name)",
        "Use colored badge matching group.color",
        "If no group assigned, show 'Unclassified' in gray",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Add group change dropdown to item detail modal",
      "description": "As a user, I want to change an item's group from the detail modal.",
      "acceptanceCriteria": [
        "Add Select dropdown below group badge in ItemDetailModal",
        "Populate with all groups from useGroups hook",
        "Show current group as selected value",
        "On change, call PATCH /api/items/:id/group with new groupId",
        "Show success toast on save",
        "Show error toast on failure",
        "Update local item data after successful save",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Create groups settings page route",
      "description": "As a user, I want a dedicated settings page to manage groups.",
      "acceptanceCriteria": [
        "Create frontend/app/settings/groups/page.tsx",
        "Add basic page layout with title 'Item Groups'",
        "Add back link to main settings page",
        "Use consistent styling with existing settings page",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Add groups list to settings page",
      "description": "As a user, I want to see all groups listed on the settings page.",
      "acceptanceCriteria": [
        "Display table/list of all groups on /settings/groups page",
        "Show columns: Color (swatch), Name, Description, Item Count, Keywords (truncated), Actions",
        "Fetch groups using useGroups hook",
        "Show loading state while fetching",
        "Add 'Add Group' button at top of list",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Create group add/edit modal component",
      "description": "As a user, I want a modal to add or edit group details.",
      "acceptanceCriteria": [
        "Create frontend/components/group-modal.tsx",
        "Modal has form fields: name (required), description, color (color picker or preset), keywords (textarea, comma-separated)",
        "Slug auto-generated from name on create (not shown to user)",
        "Accept 'group' prop for edit mode, null for create mode",
        "Accept 'onSave' callback prop",
        "Accept 'onClose' callback prop",
        "Show validation errors inline",
        "Typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Create POST /api/groups endpoint",
      "description": "As a developer, I need an API endpoint to create new groups.",
      "acceptanceCriteria": [
        "Add create method to GroupsController",
        "Accept JSON body with: name, description, keywords (array), color",
        "Auto-generate slug from name (kebab-case, must be unique)",
        "Set sort_order to max existing + 1",
        "Set is_default to false for user-created groups",
        "Return created group",
        "Return 400 if name is empty or slug already exists",
        "Add route: POST /api/groups",
        "Typecheck passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Create PUT /api/groups/:id endpoint",
      "description": "As a developer, I need an API endpoint to update existing groups.",
      "acceptanceCriteria": [
        "Add update method to GroupsController",
        "Accept JSON body with: name, description, keywords (array), color",
        "Do NOT allow changing slug (immutable after creation)",
        "Return updated group",
        "Return 404 if group not found",
        "Return 400 if validation fails",
        "Add route: PUT /api/groups/:id",
        "Typecheck passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Create DELETE /api/groups/:id endpoint",
      "description": "As a developer, I need an API endpoint to delete groups.",
      "acceptanceCriteria": [
        "Add destroy method to GroupsController",
        "Cannot delete the 'Unknown' group (return 400 with message)",
        "Cannot delete groups with assigned items (return 400 with item count)",
        "Delete group and return success message",
        "Return 404 if group not found",
        "Add route: DELETE /api/groups/:id",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Wire up group modal to settings page",
      "description": "As a user, I want to create and edit groups from the settings page.",
      "acceptanceCriteria": [
        "Add 'Add Group' button click handler that opens GroupModal in create mode",
        "Add 'Edit' button to each group row that opens GroupModal in edit mode",
        "Add 'Delete' button to each group row (only for non-default groups)",
        "Delete shows confirmation dialog before calling API",
        "On successful create/edit/delete, refetch groups list",
        "Show success/error toasts for all operations",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Create Review Unknowns page route",
      "description": "As a user, I want a dedicated page to review and classify unknown items.",
      "acceptanceCriteria": [
        "Create frontend/app/review-unknowns/page.tsx",
        "Add page title 'Review Unknown Items'",
        "Add link to this page from main settings page",
        "Use consistent layout with rest of app",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "title": "Add unknown items table to review page",
      "description": "As a user, I want to see all unknown items on the review page.",
      "acceptanceCriteria": [
        "Fetch items filtered by group=unknown using existing API",
        "Display table with columns: Checkbox, Icon, Name, Price, Suggested Group",
        "Suggested Group: apply keyword matching logic client-side to suggest a group",
        "Show 'No suggestion' if no keywords match",
        "Show loading state while fetching",
        "Show empty state if no unknown items",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Add batch selection and assignment to review page",
      "description": "As a user, I want to select multiple items and assign them to a group.",
      "acceptanceCriteria": [
        "Add checkbox to each row for selection",
        "Add 'Select All' checkbox in header",
        "Show selection count when items selected",
        "Show 'Assign to Group' dropdown when items selected",
        "Dropdown lists all available groups",
        "On selection, call PATCH /api/items/batch-group with selected item IDs",
        "Show success toast with count of updated items",
        "Refresh table after successful assignment (items should disappear from unknown list)",
        "Clear selection after successful assignment",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-031",
      "title": "Create GET /api/groups/stats endpoint",
      "description": "As a developer, I need an API endpoint that returns profitability stats per group.",
      "acceptanceCriteria": [
        "Add stats method to GroupsController",
        "Return array of objects with: group_id, group_name, group_slug, group_color, item_count, total_volume, avg_margin, total_max_profit",
        "Join items with item_prices to calculate stats",
        "avg_margin = average of (high_price - low_price) for items in group",
        "total_max_profit = sum of ((high_price - low_price) * min(buy_limit, volume)) for items in group",
        "total_volume = sum of volume for items in group",
        "Order by total_max_profit descending",
        "Add route: GET /api/groups/stats",
        "Typecheck passes"
      ],
      "priority": 31,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-032",
      "title": "Create useGroupStats frontend hook",
      "description": "As a frontend developer, I need a hook to fetch group statistics.",
      "acceptanceCriteria": [
        "Create frontend/hooks/use-group-stats.ts",
        "Define GroupStats type matching API response",
        "Implement useGroupStats() hook",
        "Return { stats: GroupStats[], isLoading: boolean, error: Error | null, refetch: () => void }",
        "Typecheck passes"
      ],
      "priority": 32,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-033",
      "title": "Add group statistics section to dashboard",
      "description": "As a user, I want to see profitability stats by group on the dashboard.",
      "acceptanceCriteria": [
        "Add collapsible 'Group Statistics' section to dashboard page",
        "Position above or below the filter panel",
        "Display compact cards/rows for each group: name (with color), item count, avg margin, total max profit",
        "Format numbers appropriately (e.g., 1.2M for millions)",
        "Clicking a group row sets the group filter to that group",
        "Add collapse/expand toggle to save space",
        "Stats refresh when dashboard polls (use same interval)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 33,
      "passes": false,
      "notes": ""
    }
  ]
}
